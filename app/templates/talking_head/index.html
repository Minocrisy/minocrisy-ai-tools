{% extends "base.html" %}

{% block title %}Minocrisy AI Tools - Talking Head{% endblock %}

{% block head %}
<style>
    .video-container {
        max-width: 100%;
        margin-top: 20px;
    }
    #loading-indicator {
        display: none;
        text-align: center;
        margin-top: 20px;
    }
    #result-container {
        display: none;
        margin-top: 20px;
    }
    .form-label {
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1>Talking Head Generator</h1>
        <p class="lead">Generate animated talking head videos from text input using ElevenLabs and RunwayML.</p>
        
        <div class="alert alert-info">
            <strong>How it works:</strong> Enter your text, and our AI will convert it to speech using ElevenLabs and animate a virtual presenter with RunwayML.
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                Input
            </div>
            <div class="card-body">
                <form id="talking-head-form">
                    <div class="mb-3">
                        <label for="text-input" class="form-label">Text to Convert</label>
                        <textarea id="text-input" class="form-control" rows="6" placeholder="Enter the text you want the talking head to say..." required></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="voice-select" class="form-label">Voice</label>
                        <select id="voice-select" class="form-select">
                            <option value="default">Default Voice</option>
                            <option value="custom">Custom Voice ID</option>
                        </select>
                    </div>
                    
                    <div id="custom-voice-container" class="mb-3" style="display: none;">
                        <label for="custom-voice-id" class="form-label">Custom Voice ID</label>
                        <input type="text" id="custom-voice-id" class="form-control" placeholder="Enter ElevenLabs Voice ID">
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Generate Talking Head</button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div id="loading-indicator">
            <div class="card">
                <div class="card-body text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Generating your talking head video...</p>
                    <p class="text-muted small">This may take a minute or two.</p>
                </div>
            </div>
        </div>
        
        <div id="result-container">
            <div class="card">
                <div class="card-header">
                    Result
                </div>
                <div class="card-body">
                    <div class="video-container">
                        <video id="result-video" controls width="100%">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="mt-3">
                        <h5>Generated Text:</h5>
                        <p id="result-text" class="border p-2 rounded"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('talking-head-form');
        const voiceSelect = document.getElementById('voice-select');
        const customVoiceContainer = document.getElementById('custom-voice-container');
        const loadingIndicator = document.getElementById('loading-indicator');
        const resultContainer = document.getElementById('result-container');
        const resultVideo = document.getElementById('result-video');
        const resultText = document.getElementById('result-text');
        
        // Show/hide custom voice ID input based on selection
        voiceSelect.addEventListener('change', function() {
            if (this.value === 'custom') {
                customVoiceContainer.style.display = 'block';
            } else {
                customVoiceContainer.style.display = 'none';
            }
        });
        
        // Handle form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const textInput = document.getElementById('text-input').value;
            let voiceId = null;
            
            if (voiceSelect.value === 'custom') {
                voiceId = document.getElementById('custom-voice-id').value;
            }
            
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            resultContainer.style.display = 'none';
            
            // Prepare request data
            const requestData = {
                text: textInput
            };
            
            if (voiceId) {
                requestData.voice_id = voiceId;
            }
            
            // Send request to API
            fetch('/tools/talking-head/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.error || 'Error generating talking head');
                    });
                }
                return response.json();
            })
            .then(data => {
                // Hide loading indicator
                loadingIndicator.style.display = 'none';
                
                // Show result
                resultContainer.style.display = 'block';
                resultVideo.src = data.video_url;
                resultText.textContent = data.text;
            })
            .catch(error => {
                // Hide loading indicator
                loadingIndicator.style.display = 'none';
                
                // Show error
                alert('Error: ' + error.message);
            });
        });
    });
</script>
{% endblock %}
